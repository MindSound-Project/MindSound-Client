<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Document</title>
    <link rel="stylesheet" href="/reset.css">
    <link rel="stylesheet" href="/css/nav.css">
    <link rel="stylesheet" href="/css/write.css">
</head>

<body>
    <style>
        .nav {
            background-color: #B8CCFF;
        }
    </style>
    <header class="navHeader">
        <nav class="nav">
            <div class="logo">
                <a href="/index.html">
                    <img src="/image/마음소리함.png" alt="">
                </a>
            </div>
            <div class="navDiv">
                <img src="/image/pen1.png" alt="" class="pen" style="margin-left: 61px;">
                <a href="/html/letter.html" class="navItem here">편지 쓰기</a>
                <a href="/html/calendar.html" class="navItem">기록 보기</a>
                <a href="/html/mypage.html" class="navItem">마이페이지</a>
            </div>
        </nav>
    </header>
    <main id="main">
        <div class="write">
            <a href="#" class="go">작성 완료</a>
            <div class="letterContainer">
                <img src="/image/울적한날의개굴편지지.png" alt="" class="letterImg">
                <div class="letterContent">
                    <input type="text" class="titleInput">
                    <textarea placeholder="내용을 입력하세요" class="bodyInput"></textarea>
                </div>
            </div>
        </div>
        <div class="email">
            <div>
                <p class="emailp">보낼 이메일</p>
                <div class="emailinput">
                    <input type="text" class="emailtext" placeholder="이메일을 입력해 주세요.">
                    <a href="/html/calendar.html">
                        <input type="button" class="emailbutton" value="보내기">
                    </a>
                </div>
            </div>
        </div>
    </main>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <script>
        const storageKey = 'letterImages';

        document.getElementsByClassName('go')[0].addEventListener('click', async () => {
            try {
                console.log("Button clicked");
                const captureArea = document.getElementsByClassName('write')[0];
                if (!captureArea) {
                    console.error("Capture area not found!");
                    alert("Error: Capture area not found.");
                    return;
                }

                console.log("Starting html2canvas...");
                const canvas = await html2canvas(captureArea);

                console.log("Canvas generated successfully.");
                const imageData = canvas.toDataURL('image/png');

                console.log("Saving to localStorage...");
                const savedImages = JSON.parse(localStorage.getItem(storageKey)) || [];
                savedImages.push(imageData);
                localStorage.setItem(storageKey, JSON.stringify(savedImages));

                console.log("Image saved to localStorage.");
                // alert('Image saved!');
            } catch (error) {
                console.error("An error occurred:", error);
                alert('An error occurred. Check the console for details.');
            }
            const emailDiv = document.querySelector('.email');
            emailDiv.classList.add('show');
        });

        /*document.getElementsByClassName('go')[0].addEventListener('click', function () {
            setTimeout(function () {    
                window.location.href = '/html/send.html';
            }, 500);
        });*/

        // URL에서 img 파라미터 읽기
        const params = new URLSearchParams(window.location.search);
        const imgSrc = decodeURIComponent(params.get('img'));

        // 이미지가 전달된 경우 표시
        if (imgSrc) {
            const letterImg = document.getElementsByClassName('letterImg')[0];
            letterImg.src = imgSrc;
        } else {
            console.error("img 파라미터가 전달되지 않았습니다.");
        }

    </script>
</body>

</html>